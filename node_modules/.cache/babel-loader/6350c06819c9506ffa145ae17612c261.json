{"ast":null,"code":"import { useEffect } from 'react';\nimport isEqual from 'lodash/isEqual';\nimport useGetPermissions from './useGetPermissions';\nimport { useSafeSetState } from '../util/hooks';\nvar emptyParams = {}; // keep a cache of already fetched permissions to initialize state for new\n// components and avoid a useless rerender if the permissions haven't changed\n\nvar alreadyFetchedPermissions = {\n  '{}': []\n};\n/**\n * Hook for getting user permissions without the loading state.\n *\n * When compared to usePermissions, this hook doesn't cause a re-render\n * when the permissions haven't changed since the last call.\n *\n * This hook doesn't handle the loading state.\n *\n * @see usePermissions\n *\n * Calls the authProvider.getPermissions() method asynchronously.\n * If the authProvider returns a rejected promise, returns empty permissions.\n *\n * The return value updates according to the request state:\n *\n * - start:   { permissions: [previously fetched permissions for these params] }\n * - success: { permissions: [permissions returned by the authProvider (usually the same as on start)] }\n * - error:   { error: [error from provider] }\n *\n * Useful to enable features based on user permissions\n *\n * @param {Object} params Any params you want to pass to the authProvider\n *\n * @returns The current auth check state. Destructure as { permissions, error }.\n *\n * @example\n *     import { usePermissionsOptimized } from 'react-admin';\n *\n *     const PostDetail = props => {\n *         const { permissions } = usePermissionsOptimized();\n *         if (permissions !== 'editor') {\n *             return <Redirect  to={`posts/${props.id}/show`} />\n *         } else {\n *             return <PostEdit {...props} />\n *         }\n *     };\n */\n\nvar usePermissionsOptimized = function (params) {\n  if (params === void 0) {\n    params = emptyParams;\n  }\n\n  var _a = useSafeSetState({\n    permissions: alreadyFetchedPermissions[JSON.stringify(params)]\n  }),\n      state = _a[0],\n      setState = _a[1];\n\n  var getPermissions = useGetPermissions();\n  useEffect(function () {\n    getPermissions(params).then(function (permissions) {\n      var key = JSON.stringify(params);\n\n      if (!isEqual(permissions, alreadyFetchedPermissions[key])) {\n        alreadyFetchedPermissions[key] = permissions;\n        setState({\n          permissions: permissions\n        });\n      }\n    }).catch(function (error) {\n      setState({\n        error: error\n      });\n    });\n  }, [getPermissions, params, setState]);\n  return state;\n};\n\nexport default usePermissionsOptimized;","map":{"version":3,"sources":["F:/TTNM/admin3/node_modules/ra-core/esm/auth/usePermissionsOptimized.js"],"names":["useEffect","isEqual","useGetPermissions","useSafeSetState","emptyParams","alreadyFetchedPermissions","usePermissionsOptimized","params","_a","permissions","JSON","stringify","state","setState","getPermissions","then","key","catch","error"],"mappings":"AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,OAAOC,OAAP,MAAoB,gBAApB;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,SAASC,eAAT,QAAgC,eAAhC;AACA,IAAIC,WAAW,GAAG,EAAlB,C,CACA;AACA;;AACA,IAAIC,yBAAyB,GAAG;AAAE,QAAM;AAAR,CAAhC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,uBAAuB,GAAG,UAAUC,MAAV,EAAkB;AAC5C,MAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;AAAEA,IAAAA,MAAM,GAAGH,WAAT;AAAuB;;AAChD,MAAII,EAAE,GAAGL,eAAe,CAAC;AACrBM,IAAAA,WAAW,EAAEJ,yBAAyB,CAACK,IAAI,CAACC,SAAL,CAAeJ,MAAf,CAAD;AADjB,GAAD,CAAxB;AAAA,MAEIK,KAAK,GAAGJ,EAAE,CAAC,CAAD,CAFd;AAAA,MAEmBK,QAAQ,GAAGL,EAAE,CAAC,CAAD,CAFhC;;AAGA,MAAIM,cAAc,GAAGZ,iBAAiB,EAAtC;AACAF,EAAAA,SAAS,CAAC,YAAY;AAClBc,IAAAA,cAAc,CAACP,MAAD,CAAd,CACKQ,IADL,CACU,UAAUN,WAAV,EAAuB;AAC7B,UAAIO,GAAG,GAAGN,IAAI,CAACC,SAAL,CAAeJ,MAAf,CAAV;;AACA,UAAI,CAACN,OAAO,CAACQ,WAAD,EAAcJ,yBAAyB,CAACW,GAAD,CAAvC,CAAZ,EAA2D;AACvDX,QAAAA,yBAAyB,CAACW,GAAD,CAAzB,GAAiCP,WAAjC;AACAI,QAAAA,QAAQ,CAAC;AAAEJ,UAAAA,WAAW,EAAEA;AAAf,SAAD,CAAR;AACH;AACJ,KAPD,EAQKQ,KARL,CAQW,UAAUC,KAAV,EAAiB;AACxBL,MAAAA,QAAQ,CAAC;AACLK,QAAAA,KAAK,EAAEA;AADF,OAAD,CAAR;AAGH,KAZD;AAaH,GAdQ,EAcN,CAACJ,cAAD,EAAiBP,MAAjB,EAAyBM,QAAzB,CAdM,CAAT;AAeA,SAAOD,KAAP;AACH,CAtBD;;AAuBA,eAAeN,uBAAf","sourcesContent":["import { useEffect } from 'react';\nimport isEqual from 'lodash/isEqual';\nimport useGetPermissions from './useGetPermissions';\nimport { useSafeSetState } from '../util/hooks';\nvar emptyParams = {};\n// keep a cache of already fetched permissions to initialize state for new\n// components and avoid a useless rerender if the permissions haven't changed\nvar alreadyFetchedPermissions = { '{}': [] };\n/**\n * Hook for getting user permissions without the loading state.\n *\n * When compared to usePermissions, this hook doesn't cause a re-render\n * when the permissions haven't changed since the last call.\n *\n * This hook doesn't handle the loading state.\n *\n * @see usePermissions\n *\n * Calls the authProvider.getPermissions() method asynchronously.\n * If the authProvider returns a rejected promise, returns empty permissions.\n *\n * The return value updates according to the request state:\n *\n * - start:   { permissions: [previously fetched permissions for these params] }\n * - success: { permissions: [permissions returned by the authProvider (usually the same as on start)] }\n * - error:   { error: [error from provider] }\n *\n * Useful to enable features based on user permissions\n *\n * @param {Object} params Any params you want to pass to the authProvider\n *\n * @returns The current auth check state. Destructure as { permissions, error }.\n *\n * @example\n *     import { usePermissionsOptimized } from 'react-admin';\n *\n *     const PostDetail = props => {\n *         const { permissions } = usePermissionsOptimized();\n *         if (permissions !== 'editor') {\n *             return <Redirect  to={`posts/${props.id}/show`} />\n *         } else {\n *             return <PostEdit {...props} />\n *         }\n *     };\n */\nvar usePermissionsOptimized = function (params) {\n    if (params === void 0) { params = emptyParams; }\n    var _a = useSafeSetState({\n        permissions: alreadyFetchedPermissions[JSON.stringify(params)],\n    }), state = _a[0], setState = _a[1];\n    var getPermissions = useGetPermissions();\n    useEffect(function () {\n        getPermissions(params)\n            .then(function (permissions) {\n            var key = JSON.stringify(params);\n            if (!isEqual(permissions, alreadyFetchedPermissions[key])) {\n                alreadyFetchedPermissions[key] = permissions;\n                setState({ permissions: permissions });\n            }\n        })\n            .catch(function (error) {\n            setState({\n                error: error,\n            });\n        });\n    }, [getPermissions, params, setState]);\n    return state;\n};\nexport default usePermissionsOptimized;\n"]},"metadata":{},"sourceType":"module"}